# Muslink ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Ubuntu 24.04 LTS

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –û–° | Ubuntu 24.04 LTS |
| CPU | 4 —è–¥—Ä–∞ |
| RAM | 8 GB |
| –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏—Å–∫ | 80 GB NVMe SSD |
| Volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö | 100 GB |
| IP | 91.98.169.75 |
| –î–æ–º–µ–Ω | mus.link |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   mus.link      ‚îÇ
                    ‚îÇ   (Cloudflare)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  91.98.169.75   ‚îÇ
                    ‚îÇ     Caddy       ‚îÇ
                    ‚îÇ   :80 / :443    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                    ‚îÇ                    ‚îÇ
        ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ React Build   ‚îÇ  ‚îÇ FastAPI Backend ‚îÇ  ‚îÇ    MongoDB      ‚îÇ
‚îÇ /var/www/...  ‚îÇ  ‚îÇ   :8001         ‚îÇ  ‚îÇ    :27017       ‚îÇ
‚îÇ   (—Å—Ç–∞—Ç–∏–∫–∞)   ‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ  /data/mongodb  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –®–∞–≥ 1: –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@91.98.169.75

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
apt update && apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
apt install -y \
    curl \
    wget \
    git \
    htop \
    nano \
    unzip \
    build-essential \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã
timedatectl set-timezone Europe/Moscow

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ hostname
hostnamectl set-hostname muslink
```

---

## –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Volume (100 GB)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∏—Å–∫–æ–≤
lsblk

# –û–±—ã—á–Ω–æ volume –±—É–¥–µ—Ç /dev/vdb –∏–ª–∏ /dev/sdb
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–∏—Å–∫ –ø—É—Å—Ç–æ–π
sudo file -s /dev/vdb

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ext4 (–µ—Å–ª–∏ –¥–∏—Å–∫ –Ω–æ–≤—ã–π!)
sudo mkfs.ext4 /dev/vdb

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
sudo mkdir -p /data

# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
sudo mount /dev/vdb /data

# –ü–æ–ª—É—á–µ–Ω–∏–µ UUID –¥–∏—Å–∫–∞
sudo blkid /dev/vdb
# –ó–∞–ø–æ–º–Ω–∏—Ç–µ UUID, –Ω–∞–ø—Ä–∏–º–µ—Ä: UUID="a1b2c3d4-..."

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ fstab –¥–ª—è –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
sudo nano /etc/fstab
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–∑–∞–º–µ–Ω–∏—Ç–µ UUID –Ω–∞ –≤–∞—à):
```
UUID=a1b2c3d4-xxxx-xxxx-xxxx-xxxxxxxxxxxx /data ext4 defaults,nofail 0 2
```

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
sudo mount -a
df -h | grep /data

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
sudo mkdir -p /data/mongodb
sudo mkdir -p /data/uploads
sudo mkdir -p /data/backups
```

---

## –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0

```bash
# –ò–º–ø–æ—Ä—Ç GPG –∫–ª—é—á–∞ MongoDB
curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | \
   sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg --dearmor

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è Ubuntu 24.04 (noble)
echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu noble/mongodb-org/7.0 multiverse" | \
   sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt update
sudo apt install -y mongodb-org

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sudo systemctl stop mongod
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ volume

```bash
sudo nano /etc/mongod.conf
```

–ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞:

```yaml
# mongod.conf

# –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
storage:
  dbPath: /data/mongodb
  journal:
    enabled: true
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log

# –°–µ—Ç—å
net:
  port: 27017
  bindIp: 127.0.0.1

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
security:
  authorization: disabled

# –ü—Ä–æ—Ü–µ—Å—Å
processManagement:
  timeZoneInfo: /usr/share/zoneinfo
```

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–∞–Ω–Ω—ã—Ö
sudo chown -R mongodb:mongodb /data/mongodb

# –ó–∞–ø—É—Å–∫ MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status mongod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
mongosh --eval "db.runCommand({ ping: 1 })"
```

---

## –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20 LTS

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20 (LTS)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π
node -v   # v20.x.x
npm -v    # 10.x.x

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ yarn –≥–ª–æ–±–∞–ª—å–Ω–æ
sudo npm install -g yarn
```

---

## –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python 3.12

Ubuntu 24.04 —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç Python 3.12:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
python3 --version   # Python 3.12.x

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pip –∏ venv
sudo apt install -y python3-pip python3-venv python3-dev

# –ü—Ä–æ–≤–µ—Ä–∫–∞ pip
pip3 --version
```

---

## –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Caddy

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Caddy
sudo apt install -y debian-keyring debian-archive-keyring

curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | \
   sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg

curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | \
   sudo tee /etc/apt/sources.list.d/caddy-stable.list

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt update
sudo apt install -y caddy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
caddy version
```

---

## –®–∞–≥ 7: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /var/www
cd /var/www

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à)
sudo git clone https://github.com/YOUR_USERNAME/muslink.git

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
sudo chown -R www-data:www-data /var/www/muslink
sudo chmod -R 755 /var/www/muslink

cd /var/www/muslink
```

---

## –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend

```bash
cd /var/www/muslink/backend

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
sudo -u www-data python3 -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip
pip install --upgrade pip

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
deactivate
```

### –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
sudo nano /var/www/muslink/backend/.env
```

```env
# ===== DATABASE =====
MONGO_URL=mongodb://127.0.0.1:27017/muslink
DB_NAME=muslink

# ===== SECURITY =====
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ: openssl rand -hex 32
JWT_SECRET=–ó–ê–ú–ï–ù–ò–¢–ï_–ù–ê_–°–í–û–ô_–°–ï–ö–†–ï–¢–ù–´–ô_–ö–õ–Æ–ß_–ú–ò–ù–ò–ú–£–ú_32_–°–ò–ú–í–û–õ–ê

# ===== OWNER =====
# Email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ owner –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
OWNER_EMAIL=–≤–∞—à-email@example.com

# ===== URLS =====
FRONTEND_URL=https://mus.link
MAIN_DOMAIN=mus.link
CORS_ORIGINS=https://mus.link,https://www.mus.link

# ===== EMAIL (Resend.com) =====
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxx
SENDER_EMAIL=noreply@mus.link

# ===== UPLOADS =====
UPLOADS_PATH=/data/uploads

# ===== AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) =====
HUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxxxxxxxxx
```

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
sudo chown www-data:www-data /var/www/muslink/backend/.env
sudo chmod 600 /var/www/muslink/backend/.env
```

---

## –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Frontend

```bash
cd /var/www/muslink/frontend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo -u www-data yarn install

# –°–æ–∑–¥–∞–Ω–∏–µ .env
sudo nano /var/www/muslink/frontend/.env
```

```env
REACT_APP_BACKEND_URL=https://mus.link
```

```bash
# –°–±–æ—Ä–∫–∞ production –≤–µ—Ä—Å–∏–∏
sudo -u www-data yarn build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
ls -la /var/www/muslink/frontend/build/
```

---

## –®–∞–≥ 10: –°–æ–∑–¥–∞–Ω–∏–µ Systemd —Å–µ—Ä–≤–∏—Å–∞

```bash
sudo nano /etc/systemd/system/muslink.service
```

```ini
[Unit]
Description=Muslink Backend API
After=network.target mongod.service
Wants=mongod.service

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/var/www/muslink/backend

# –û–∫—Ä—É–∂–µ–Ω–∏–µ
Environment="PATH=/var/www/muslink/backend/venv/bin:/usr/local/bin:/usr/bin:/bin"
EnvironmentFile=/var/www/muslink/backend/.env

# –ó–∞–ø—É—Å–∫ Uvicorn
ExecStart=/var/www/muslink/backend/venv/bin/uvicorn server:app \
    --host 127.0.0.1 \
    --port 8001 \
    --workers 4 \
    --loop uvloop \
    --http httptools

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
Restart=always
RestartSec=5
StartLimitIntervalSec=60
StartLimitBurst=3

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
StandardOutput=append:/var/log/muslink/backend.log
StandardError=append:/var/log/muslink/error.log

# –õ–∏–º–∏—Ç—ã
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
```

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
sudo mkdir -p /var/log/muslink
sudo chown www-data:www-data /var/log/muslink

# –ü—Ä–∞–≤–∞ –Ω–∞ uploads
sudo chown -R www-data:www-data /data/uploads

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ systemd
sudo systemctl daemon-reload

# –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl enable muslink
sudo systemctl start muslink

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status muslink

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://127.0.0.1:8001/api/auth/login \
    -X POST \
    -H "Content-Type: application/json" \
    -d '{"email":"test@test.com","password":"test"}'
```

---

## –®–∞–≥ 11: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Caddy

```bash
sudo nano /etc/caddy/Caddyfile
```

```caddyfile
# ============================
# Muslink - Caddy Configuration
# Domain: mus.link
# Server: 91.98.169.75
# ============================

mus.link {
    # ========== LOGGING ==========
    log {
        output file /var/log/caddy/access.log {
            roll_size 50mb
            roll_keep 10
            roll_keep_for 720h
        }
        format json
    }

    # ========== OG BOTS (–¥–ª—è –ø—Ä–µ–≤—å—é –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö) ==========
    @ogbots {
        header_regexp User-Agent (?i)(facebookexternalhit|Twitterbot|LinkedInBot|WhatsApp|TelegramBot|Slackbot|Discordbot|vkShare|Viber|Pinterest|Googlebot)
    }

    # –†–æ—É—Ç–∏–Ω–≥ –¥–ª—è –±–æ—Ç–æ–≤ - –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    @publicpath {
        not path /api/* /static/* /assets/* /login /register /forgot-password /reset-password/* /admin/*
    }

    handle @ogbots {
        handle @publicpath {
            rewrite * /api/s{uri}
            reverse_proxy 127.0.0.1:8001
        }
        handle {
            reverse_proxy 127.0.0.1:8001
        }
    }

    # ========== API ==========
    handle /api/* {
        reverse_proxy 127.0.0.1:8001 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            
            # –¢–∞–π–º–∞—É—Ç—ã
            transport http {
                read_timeout 60s
                write_timeout 60s
            }
        }
    }

    # ========== UPLOADS ==========
    handle /uploads/* {
        root * /data
        file_server {
            precompressed gzip br
        }
        header Cache-Control "public, max-age=31536000, immutable"
    }

    # ========== FRONTEND (React) ==========
    handle {
        root * /var/www/muslink/frontend/build
        
        # SPA —Ä–æ—É—Ç–∏–Ω–≥
        try_files {path} /index.html
        
        file_server {
            precompressed gzip br
        }
    }

    # ========== COMPRESSION ==========
    encode {
        gzip 6
        zstd
    }

    # ========== SECURITY HEADERS ==========
    header {
        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
        
        # –°–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–µ—Ä–µ
        -Server
        -X-Powered-By
    }

    # ========== STATIC CACHE ==========
    @staticFiles {
        path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
    }
    header @staticFiles {
        Cache-Control "public, max-age=31536000, immutable"
    }

    # ========== TLS ==========
    tls {
        protocols tls1.2 tls1.3
    }
}

# ========== WWW REDIRECT ==========
www.mus.link {
    redir https://mus.link{uri} permanent
}

# ========== HTTP REDIRECT ==========
http://mus.link, http://www.mus.link {
    redir https://mus.link{uri} permanent
}
```

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤ Caddy
sudo mkdir -p /var/log/caddy
sudo chown caddy:caddy /var/log/caddy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
sudo caddy validate --config /etc/caddy/Caddyfile

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
sudo caddy fmt --overwrite /etc/caddy/Caddyfile

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Caddy
sudo systemctl restart caddy
sudo systemctl enable caddy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status caddy
```

---

## –®–∞–≥ 12: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

–í –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–º mus.link –¥–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å–∏:

| –¢–∏–ø | –ò–º—è | –ó–Ω–∞—á–µ–Ω–∏–µ | TTL |
|-----|-----|----------|-----|
| A | @ | 91.98.169.75 | 300 |
| A | www | 91.98.169.75 | 300 |

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare:**
- –í–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
- SSL/TLS: Full (strict)
- Always Use HTTPS: On

---

## –®–∞–≥ 13: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ UFW
sudo apt install -y ufw

# –ü—Ä–∞–≤–∏–ª–∞
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH
sudo ufw allow 22/tcp

# HTTP –∏ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# –í–∫–ª—é—á–µ–Ω–∏–µ
sudo ufw enable

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo ufw status verbose
```

---

## –®–∞–≥ 14: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2ban

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt install -y fail2ban

# –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nano /etc/fail2ban/jail.local
```

```ini
[DEFAULT]
bantime = 1h
findtime = 10m
maxretry = 5
ignoreip = 127.0.0.1/8

[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 24h
```

```bash
# –ó–∞–ø—É—Å–∫
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo fail2ban-client status sshd
```

---

## –®–∞–≥ 15: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```bash
sudo nano /data/backups/backup.sh
```

```bash
#!/bin/bash
# =============================================
# Muslink Backup Script
# =============================================

set -e

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BACKUP_DIR="/data/backups"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=14
CURRENT_BACKUP="$BACKUP_DIR/$DATE"

echo "=========================================="
echo "Starting backup: $DATE"
echo "=========================================="

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p "$CURRENT_BACKUP"

# 1. –ë—ç–∫–∞–ø MongoDB
echo "[1/3] Backing up MongoDB..."
mongodump --db muslink --out "$CURRENT_BACKUP/mongodb" --quiet

# 2. –ë—ç–∫–∞–ø uploads
echo "[2/3] Backing up uploads..."
tar -czf "$CURRENT_BACKUP/uploads.tar.gz" -C /data uploads 2>/dev/null || true

# 3. –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥–æ–≤
echo "[3/3] Backing up configs..."
tar -czf "$CURRENT_BACKUP/configs.tar.gz" \
    /var/www/muslink/backend/.env \
    /var/www/muslink/frontend/.env \
    /etc/caddy/Caddyfile \
    /etc/systemd/system/muslink.service \
    2>/dev/null || true

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
echo "Removing backups older than $RETENTION_DAYS days..."
find "$BACKUP_DIR" -maxdepth 1 -type d -name "20*" -mtime +$RETENTION_DAYS -exec rm -rf {} \; 2>/dev/null || true

# –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞
BACKUP_SIZE=$(du -sh "$CURRENT_BACKUP" | cut -f1)

echo "=========================================="
echo "Backup completed!"
echo "Location: $CURRENT_BACKUP"
echo "Size: $BACKUP_SIZE"
echo "=========================================="
```

```bash
# –ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
sudo chmod +x /data/backups/backup.sh

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
sudo /data/backups/backup.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 4:00)
sudo crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
```
0 4 * * * /data/backups/backup.sh >> /var/log/muslink/backup.log 2>&1
```

---

## –®–∞–≥ 16: Logrotate –¥–ª—è –ª–æ–≥–æ–≤

```bash
sudo nano /etc/logrotate.d/muslink
```

```
/var/log/muslink/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        systemctl reload muslink > /dev/null 2>&1 || true
    endscript
}
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status mongod caddy muslink

# –ü–æ—Ä—Ç—ã
sudo ss -tlnp | grep -E "27017|8001|80|443"
```

### API

```bash
curl -s http://127.0.0.1:8001/api/health || echo "Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
```

### HTTPS

```bash
curl -I https://mus.link
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞

```bash
df -h
du -sh /data/*
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# ===== –õ–û–ì–ò =====
# Backend
sudo tail -f /var/log/muslink/backend.log
sudo tail -f /var/log/muslink/error.log

# Caddy
sudo tail -f /var/log/caddy/access.log

# MongoDB
sudo tail -f /var/log/mongodb/mongod.log

# ===== –ü–ï–†–ï–ó–ê–ü–£–°–ö =====
sudo systemctl restart muslink      # Backend
sudo systemctl restart caddy        # –í–µ–±-—Å–µ—Ä–≤–µ—Ä
sudo systemctl restart mongod       # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

# ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–î–ê =====
cd /var/www/muslink
sudo -u www-data git pull

# Backend
cd backend
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart muslink

# Frontend
cd ../frontend
sudo -u www-data yarn install
sudo -u www-data yarn build

# ===== –ú–û–ù–ò–¢–û–†–ò–ù–ì =====
htop                    # –ü—Ä–æ—Ü–µ—Å—Å—ã
df -h                   # –î–∏—Å–∫–∏
free -h                 # –ü–∞–º—è—Ç—å
sudo journalctl -f      # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
```

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://mus.link
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å email –∏–∑ `OWNER_EMAIL`
3. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É ‚Äî –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ä–æ–ª—å owner
4. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Ç–µ—Å—Ç–∞
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OG-—Ç–µ–≥–∏: https://developers.facebook.com/tools/debug/

**–°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**
